<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Heart For Thal!!</title>

<!-- Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@500;700&family=Dancing+Script:wght@600&display=swap" rel="stylesheet">

<style>
  html,body {
    height:100%;
    margin:0;
    overflow:hidden;
    background:#000;
  }
  canvas {
    display:block;
    width:100vw;
    height:100vh;
  }
  #hint {
    position: fixed;
    left: 12px;
    bottom: 12px;
    padding:8px 10px;
    border-radius:8px;
    background: rgba(255,255,255,0.08);
    color: white;
    font-size:13px;
    font-family:'Poppins', sans-serif;
    z-index: 10;
    backdrop-filter: blur(6px);
  }

  /* Overlay for lyrics */
  #overlay {
    position: fixed;
    top:0; left:0;
    width:100%; height:100%;
    background:black;
    opacity:0;
    pointer-events:none;
    transition: opacity 2.5s ease;
    z-index: 999;
    overflow:hidden;
    display:flex;
    justify-content:center;
    align-items:center;
  }
  #overlay.show {
    opacity:1;
    pointer-events:auto;
  }

  /* star background in overlay */
  #overlayStars {
    position:absolute;
    top:0;
    left:0;
    width:100%;
    height:100%;
    background: transparent;
    z-index:0;
  }

  #lyrics {
    position:relative;
    color:white;
    font-size:2.4em;
    font-family:'Dancing Script', cursive;
    opacity:0;
    transition: opacity 4s ease;
    text-align:center;
    letter-spacing: 2px;
    z-index:2;
    text-shadow:0 0 20px rgba(255,255,255,0.8);
  }
  #overlay.show #lyrics {
    opacity:1;
  }
</style>
</head>
<body>
<canvas id="c"></canvas>
<div id="hint">Tap/Click to re-form the heart • Tap again for a surprise ✨</div>

<!-- Fade to black and lyrics with stars -->
<div id="overlay">
  <canvas id="overlayStars"></canvas>
  <div id="lyrics">“HAPPY BIRTHDAY!!”</div>
</div>

<!-- Audio -->
<audio id="song" preload="auto">
  <source src="thal3.mp3" type="audio/mpeg">
  Your browser does not support the audio element.
</audio>

<script>
(function () {
  'use strict';
  const canvas = document.getElementById('c');
  const ctx = canvas.getContext('2d');
  const overlay = document.getElementById('overlay');
  const song = document.getElementById('song');
  const overlayCanvas = document.getElementById('overlayStars');
  const octx = overlayCanvas.getContext('2d');

  // Create a hidden video element
  const video = document.createElement('video');
  video.src = "me.mp4"; // <--- replace this with your actual video link
  video.style.position = "fixed";
  video.style.top = "0";
  video.style.left = "0";
  video.style.width = "100%";
  video.style.height = "100%";
  video.style.objectFit = "cover";
  video.style.zIndex = "500";
  video.style.display = "none";
  video.controls = false;
  video.autoplay = false;
  document.body.appendChild(video);

  let DPR = Math.max(window.devicePixelRatio || 1, 1);

  const CONFIG = {
    heartScale: 32,
    step: 0.005,
    particleMinSize: 0.9,
    particleMaxSize: 2.2,
    speedMin: 0.006,
    speedMax: 0.012,
    starCount: 400,
    overlayStarCount: 250,
    strokeWidth: 14,
    strokeGlow: 28,
    pulseThreshold: 1.2,
  };

  let W = 0, H = 0;
  let particles = [], heartPath = [], stars = [], overlayStars = [];
  let formed = false, pulseTimer = 0, bgGradient;

  function setSize() {
    DPR = Math.max(window.devicePixelRatio || 1, 1);
    W = window.innerWidth;
    H = window.innerHeight;
    [canvas, overlayCanvas].forEach(c => {
      c.style.width = W + 'px';
      c.style.height = H + 'px';
      c.width = Math.round(W * DPR);
      c.height = Math.round(H * DPR);
    });
    ctx.setTransform(DPR, 0, 0, DPR, 0, 0);
    octx.setTransform(DPR, 0, 0, DPR, 0, 0);
    createGradient();
    createStars();
    createHeart();
    createOverlayStars();
  }

  function createGradient() {
    const g = ctx.createLinearGradient(0, 0, W, H);
    g.addColorStop(0, '#ff6ec7');
    g.addColorStop(0.45, '#b05cff');
    g.addColorStop(1, '#2aa1ff');
    bgGradient = g;
  }

  function createStars() {
    stars = [];
    for (let i = 0; i < CONFIG.starCount; i++) {
      stars.push({
        x: Math.random() * W,
        y: Math.random() * H,
        r: Math.random() * 1.8 + 0.2,
        baseA: Math.random() * 0.8 + 0.2,
        speed: Math.random() * 0.008 + 0.002
      });
    }
  }

  function createOverlayStars() {
    overlayStars = [];
    for (let i = 0; i < CONFIG.overlayStarCount; i++) {
      overlayStars.push({
        x: Math.random() * W,
        y: Math.random() * H,
        r: Math.random() * 2 + 0.5,
        baseA: Math.random() * 0.7 + 0.3,
        speed: Math.random() * 0.004 + 0.001
      });
    }
  }

  function drawOverlayStars(time) {
    octx.clearRect(0, 0, W, H);
    for (let s of overlayStars) {
      const a = s.baseA * (0.6 + 0.4 * Math.sin(time * s.speed));
      octx.globalAlpha = a;
      octx.beginPath();
      octx.arc(s.x, s.y, s.r, 0, Math.PI * 2);
      octx.fillStyle = '#fff';
      octx.fill();
    }
    octx.globalAlpha = 1;
  }

  function heartXY(t) {
    const x = 16 * Math.pow(Math.sin(t), 3);
    const y = -(13 * Math.cos(t) - 5 * Math.cos(2*t) - 2 * Math.cos(3*t) - Math.cos(4*t));
    return { x, y };
  }

  function createHeart() {
    particles = [];
    heartPath = [];
    const cx = W / 2;
    const cy = H / 2;
    const step = CONFIG.step;
    const scale = CONFIG.heartScale;
    for (let a = 0; a < Math.PI * 2; a += step) {
      const p = heartXY(a);
      const tx = cx + p.x * scale;
      const ty = cy + p.y * scale;
      heartPath.push({ x: tx, y: ty });
      const startX = Math.random() * W;
      const startY = Math.random() * H;
      particles.push({
        x: startX, y: startY, tx, ty,
        size: CONFIG.particleMinSize + Math.random() * (CONFIG.particleMaxSize - CONFIG.particleMinSize),
        color: particleRedShade(),
        speed: CONFIG.speedMin + Math.random() * (CONFIG.speedMax - CONFIG.speedMin)
      });
    }
    formed = false;
    pulseTimer = 0;
  }

  function particleRedShade() {
    const light = 38 + Math.random() * 18;
    return `hsl(0, 92%, ${light}%)`;
  }

  function drawBackground() {
    ctx.fillStyle = bgGradient;
    ctx.fillRect(0, 0, W, H);
  }

  function drawStars(time) {
    ctx.save();
    for (let s of stars) {
      const a = s.baseA * (0.6 + 0.4 * Math.sin((time * s.speed)));
      ctx.globalAlpha = a;
      ctx.beginPath();
      ctx.arc(s.x, s.y, s.r, 0, Math.PI * 2);
      ctx.fillStyle = '#fff';
      ctx.fill();
    }
    ctx.globalAlpha = 1;
    ctx.restore();
  }

  function drawHeartStroke(pulse = 0) {
    if (!heartPath.length) return;
    ctx.save();
    ctx.beginPath();
    ctx.moveTo(heartPath[0].x, heartPath[0].y);
    for (let i = 1; i < heartPath.length; i++) ctx.lineTo(heartPath[i].x, heartPath[i].y);
    ctx.closePath();
    ctx.lineWidth = CONFIG.strokeWidth + pulse * 8;
    ctx.strokeStyle = 'rgba(255,60,80,0.85)';
    ctx.shadowBlur = CONFIG.strokeGlow + pulse * 30;
    ctx.shadowColor = 'rgba(255,40,40,0.9)';
    ctx.lineJoin = 'round';
    ctx.lineCap = 'round';
    ctx.stroke();
    ctx.lineWidth = Math.max(3, CONFIG.strokeWidth * 0.45);
    ctx.shadowBlur = 0;
    ctx.strokeStyle = 'rgba(255,30,30,0.95)';
    ctx.stroke();
    ctx.restore();
  }

  function updateAndDrawParticles() {
    let totalDist = 0;
    for (let p of particles) {
      const dx = p.tx - p.x;
      const dy = p.ty - p.y;
      p.x += dx * p.speed;
      p.y += dy * p.speed;
      ctx.beginPath();
      ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
      ctx.fillStyle = p.color;
      ctx.fill();
      totalDist += Math.hypot(dx, dy);
    }
    return totalDist / particles.length;
  }

  function drawCenterText(time) {
    ctx.save();
    ctx.font = `700 ${Math.min(W, H) * 0.1}px 'Poppins', sans-serif`;
    ctx.textAlign = "center";
    ctx.textBaseline = "middle";
    const grad = ctx.createLinearGradient(W/2 - 150, H/2, W/2 + 150, H/2);
    grad.addColorStop(0, "#ff1a1a");
    grad.addColorStop(1, "#ff7adf");
    ctx.fillStyle = grad;
    const glow = Math.abs(Math.sin(time * 0.002)) * 40 + 40;
    ctx.shadowColor = "rgba(255,0,0,0.9)";
    ctx.shadowBlur = glow;
    ctx.fillText("My Lovelove!!", W / 2, H / 2);
    ctx.restore();
  }

  function animate(time = 0) {
    ctx.clearRect(0, 0, W, H);
    drawBackground();
    drawStars(time);
    const avgDist = updateAndDrawParticles();
    if (!formed && avgDist < CONFIG.pulseThreshold) {
      formed = true;
      pulseTimer = 1.0;
    }
    if (pulseTimer > 0) {
      drawHeartStroke(Math.min(1, pulseTimer));
      pulseTimer *= 0.94;
    } else {
      drawHeartStroke(Math.abs(Math.sin(time * 0.001)) * 0.12);
    }
    drawCenterText(time);
    if (overlay.classList.contains('show')) drawOverlayStars(time);
    requestAnimationFrame(animate);
  }

  // Click: play video first
  canvas.addEventListener('click', () => {
    video.style.display = "block";
    video.currentTime = 0;
    video.play().catch(e => console.log('Video play blocked:', e));
  });

  // When video ends: fade in overlay + play song + show text slowly
  video.addEventListener('ended', () => {
    video.style.display = "none";
    overlay.classList.add('show');
    song.currentTime = 0;
    song.play().catch(e => console.log('Audio play blocked:', e));
  });

  window.addEventListener('resize', setSize);
  setSize();
  requestAnimationFrame(animate);
})();
</script>

</body>
</html>
